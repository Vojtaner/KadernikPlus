{"version":3,"file":"make-express-callback.js","sources":["adapters/express/make-express-callback.ts"],"sourceRoot":"/","sourcesContent":["// src/frameworks/express/utils/make-express-callback.ts\n\nimport { Request, Response, NextFunction } from \"express\";\nimport { ParamsDictionary } from \"express-serve-static-core\";\nimport QueryString from \"qs\";\n\n/**\n * Interface for a custom HTTP request object, extending Express's Request.\n * This can be used to add custom properties (like 'context' for authenticated user, etc.)\n * that might be set by middleware.\n */\nexport interface CustomRequest extends Request {\n  // Add any custom properties here, e.g.:\n  // userId?: string;\n  // user?: { id: string; email: string; name?: string };\n}\n\nexport type ControllerFunction<T = { body?: any; params?: any; query?: any }> =\n  {\n    (httpRequest: {\n      body: T extends { body: infer B } ? B : any;\n      params: T extends { params: infer P } ? P : any;\n      query: T extends { query: infer Q } ? Q : any;\n      ip: string;\n      method: string;\n      path: string;\n      userId: string;\n      headers: {\n        [key: string]: string | string[] | undefined;\n      };\n    }): Promise<{\n      headers?: { [key: string]: string };\n      statusCode: number;\n      body?: any;\n    }>;\n  };\n\nexport const makeExpressCallback = <T>(controller: ControllerFunction<T>) => {\n  return async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      const httpRequest = {\n        body: req.body,\n        query: req.query,\n        params: req.params,\n        ip: req.ip || \"ipError\",\n        method: req.method,\n        path: req.path,\n        userId: req.auth?.payload.sub,\n        headers: req.headers,\n      } as any;\n\n      const httpResponse = await controller(httpRequest);\n\n      if (httpResponse.headers) {\n        res.set(httpResponse.headers);\n      }\n      res.status(httpResponse.statusCode).send(httpResponse.body);\n    } catch (e: any) {\n      console.error(\"Error in makeExpressCallback:\", e);\n      res.status(e.status).send({\n        message: e.message || \"Neznámý error,chyba serveru.\",\n        status: e.status || 500,\n      });\n    }\n  };\n};\n"],"names":[],"mappings":";;;AAAA,wDAAwD;;;AAqCjD,MAAM,mBAAmB,GAAG,CAAI,UAAiC,EAAE,EAAE;IAC1E,OAAO,KAAK,EAAE,GAAY,EAAE,GAAa,EAAE,IAAkB,EAAE,EAAE;QAC/D,IAAI,CAAC;YACH,MAAM,WAAW,GAAG;gBAClB,IAAI,EAAE,GAAG,CAAC,IAAI;gBACd,KAAK,EAAE,GAAG,CAAC,KAAK;gBAChB,MAAM,EAAE,GAAG,CAAC,MAAM;gBAClB,EAAE,EAAE,GAAG,CAAC,EAAE,IAAI,SAAS;gBACvB,MAAM,EAAE,GAAG,CAAC,MAAM;gBAClB,IAAI,EAAE,GAAG,CAAC,IAAI;gBACd,MAAM,EAAE,GAAG,CAAC,IAAI,EAAE,OAAO,CAAC,GAAG;gBAC7B,OAAO,EAAE,GAAG,CAAC,OAAO;aACd,CAAC;YAET,MAAM,YAAY,GAAG,MAAM,UAAU,CAAC,WAAW,CAAC,CAAC;YAEnD,IAAI,YAAY,CAAC,OAAO,EAAE,CAAC;gBACzB,GAAG,CAAC,GAAG,CAAC,YAAY,CAAC,OAAO,CAAC,CAAC;YAChC,CAAC;YACD,GAAG,CAAC,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC;QAC9D,CAAC;QAAC,OAAO,CAAM,EAAE,CAAC;YAChB,OAAO,CAAC,KAAK,CAAC,+BAA+B,EAAE,CAAC,CAAC,CAAC;YAClD,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC;gBACxB,OAAO,EAAE,CAAC,CAAC,OAAO,IAAI,8BAA8B;gBACpD,MAAM,EAAE,CAAC,CAAC,MAAM,IAAI,GAAG;aACxB,CAAC,CAAC;QACL,CAAC;IACH,CAAC,CAAC;AACJ,CAAC,CAAC;AA5BW,QAAA,mBAAmB,uBA4B9B","debug_id":"ff652841-0d76-5a05-8165-f0ad1fc79189"}
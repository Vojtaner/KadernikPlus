{"version":3,"file":"ensureUserExistsMiddleware.js","sources":["adapters/express/ensureUserExistsMiddleware.ts"],"sourceRoot":"/","sourcesContent":["import { Request, Response, NextFunction } from \"express\";\nimport { type EnsureUserExistsUseCaseType } from \"../../application/use-cases/user/ensure-user-exists\";\n\nconst ensureUserExistsMiddleware = (\n  ensureUserExistsUseCase: EnsureUserExistsUseCaseType\n) => {\n  return async (\n    req: Request,\n    res: Response,\n    next: NextFunction\n  ): Promise<void> => {\n    try {\n      const userId = req.auth?.payload.sub;\n\n      if (!userId) {\n        res.status(401).json({ error: \"Chybí uživatelské ID.\" });\n        return;\n      }\n\n      await ensureUserExistsUseCase.execute(userId);\n\n      next();\n    } catch (err) {\n      console.error(\"ensureUserExists error:\", err);\n      res.status(500).json({ error: \"Failed to ensure user exists\" });\n    }\n  };\n};\n\nexport default ensureUserExistsMiddleware;\n"],"names":[],"mappings":";;;;AAGA,MAAM,0BAA0B,GAAG,CACjC,uBAAoD,EACpD,EAAE;IACF,OAAO,KAAK,EACV,GAAY,EACZ,GAAa,EACb,IAAkB,EACH,EAAE;QACjB,IAAI,CAAC;YACH,MAAM,MAAM,GAAG,GAAG,CAAC,IAAI,EAAE,OAAO,CAAC,GAAG,CAAC;YAErC,IAAI,CAAC,MAAM,EAAE,CAAC;gBACZ,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,KAAK,EAAE,uBAAuB,EAAE,CAAC,CAAC;gBACzD,OAAO;YACT,CAAC;YAED,MAAM,uBAAuB,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;YAE9C,IAAI,EAAE,CAAC;QACT,CAAC;QAAC,OAAO,GAAG,EAAE,CAAC;YACb,OAAO,CAAC,KAAK,CAAC,yBAAyB,EAAE,GAAG,CAAC,CAAC;YAC9C,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,KAAK,EAAE,8BAA8B,EAAE,CAAC,CAAC;QAClE,CAAC;IACH,CAAC,CAAC;AACJ,CAAC,CAAC;AAEF,kBAAe,0BAA0B,CAAC","debug_id":"f2bbfa69-df59-555a-afc2-b7707f61b15a"}
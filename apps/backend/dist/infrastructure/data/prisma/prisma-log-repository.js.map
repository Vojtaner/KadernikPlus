{"version":3,"file":"prisma-log-repository.js","sources":["infrastructure/data/prisma/prisma-log-repository.ts"],"sourceRoot":"/","sourcesContent":["import { Prisma, PrismaClient } from \"@prisma/client\";\nimport prisma from \"./prisma\";\n\nexport type LogData = {\n  userId: string;\n  action: string;\n  entityType: string;\n  entityId: string;\n  message: string;\n  metadata: any;\n  teamId: string;\n};\n\nexport type Logs = Prisma.LogEntryGetPayload<{\n  include: {\n    user: true;\n  };\n}>;\n\nconst createLogRepository = (prisma: PrismaClient) => {\n  return {\n    log: async (logData: LogData): Promise<void> => {\n      await prisma.logEntry.create({ data: logData });\n    },\n    getAllLogs: async (userId: string): Promise<Logs[]> => {\n      const teamMember = await prisma.teamMember.findUnique({\n        where: { userId },\n      });\n\n      const logs = await prisma.logEntry.findMany({\n        where: { OR: [{ teamId: teamMember?.teamId, userId }] },\n        include: { user: true },\n        orderBy: { createdAt: \"desc\" },\n      });\n\n      return logs;\n    },\n  };\n};\n\nconst logRepositoryDb = createLogRepository(prisma);\n\nexport default logRepositoryDb;\n"],"names":[],"mappings":";;;;;;;AACA,sDAA8B;AAkB9B,MAAM,mBAAmB,GAAG,CAAC,MAAoB,EAAE,EAAE;IACnD,OAAO;QACL,GAAG,EAAE,KAAK,EAAE,OAAgB,EAAiB,EAAE;YAC7C,MAAM,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE,IAAI,EAAE,OAAO,EAAE,CAAC,CAAC;QAClD,CAAC;QACD,UAAU,EAAE,KAAK,EAAE,MAAc,EAAmB,EAAE;YACpD,MAAM,UAAU,GAAG,MAAM,MAAM,CAAC,UAAU,CAAC,UAAU,CAAC;gBACpD,KAAK,EAAE,EAAE,MAAM,EAAE;aAClB,CAAC,CAAC;YAEH,MAAM,IAAI,GAAG,MAAM,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC;gBAC1C,KAAK,EAAE,EAAE,EAAE,EAAE,CAAC,EAAE,MAAM,EAAE,UAAU,EAAE,MAAM,EAAE,MAAM,EAAE,CAAC,EAAE;gBACvD,OAAO,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE;gBACvB,OAAO,EAAE,EAAE,SAAS,EAAE,MAAM,EAAE;aAC/B,CAAC,CAAC;YAEH,OAAO,IAAI,CAAC;QACd,CAAC;KACF,CAAC;AACJ,CAAC,CAAC;AAEF,MAAM,eAAe,GAAG,mBAAmB,CAAC,gBAAM,CAAC,CAAC;AAEpD,kBAAe,eAAe,CAAC","debug_id":"d0ba9e29-7bb1-512a-93e9-e52b60c595aa"}
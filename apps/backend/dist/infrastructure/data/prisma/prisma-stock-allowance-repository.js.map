{"version":3,"file":"prisma-stock-allowance-repository.js","sources":["infrastructure/data/prisma/prisma-stock-allowance-repository.ts"],"sourceRoot":"/","sourcesContent":["import { PrismaClient } from \".prisma/client\";\nimport { StockAllowanceRepositoryPort } from \"../../../application/ports/stock-allowance-repository\";\nimport prisma from \"./prisma\";\nimport { StockAllowanceWithProcedureAndItem } from \"@/entities/stock-allowance\";\n\nconst createStockAllowanceRepositoryDb = (\n  prisma: PrismaClient\n): StockAllowanceRepositoryPort => {\n  return {\n    getAllByDatesAndTeamId: async (\n      teamId: string,\n      fromDate: Date,\n      toDate: Date\n    ): Promise<StockAllowanceWithProcedureAndItem[]> => {\n      const stockAllowances = await prisma.stockAllowance.findMany({\n        where: {\n          teamId,\n          createdAt: { gte: fromDate, lte: toDate },\n        },\n        include: {\n          procedure: {\n            select: { visitId: true, visit: { select: { clientId: true } } },\n          },\n          stockItem: {\n            select: { itemName: true, avgUnitPrice: true, unit: true },\n          },\n          user: { select: { name: true } },\n        },\n      });\n\n      console.log({ stockAllowances });\n      return stockAllowances;\n    },\n  };\n};\n\nconst stockAllowanceRepositoryDb = createStockAllowanceRepositoryDb(prisma);\n\nexport default stockAllowanceRepositoryDb;\n"],"names":[],"mappings":";;;;;;;AAEA,sDAA8B;AAG9B,MAAM,gCAAgC,GAAG,CACvC,MAAoB,EACU,EAAE;IAChC,OAAO;QACL,sBAAsB,EAAE,KAAK,EAC3B,MAAc,EACd,QAAc,EACd,MAAY,EACmC,EAAE;YACjD,MAAM,eAAe,GAAG,MAAM,MAAM,CAAC,cAAc,CAAC,QAAQ,CAAC;gBAC3D,KAAK,EAAE;oBACL,MAAM;oBACN,SAAS,EAAE,EAAE,GAAG,EAAE,QAAQ,EAAE,GAAG,EAAE,MAAM,EAAE;iBAC1C;gBACD,OAAO,EAAE;oBACP,SAAS,EAAE;wBACT,MAAM,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,KAAK,EAAE,EAAE,MAAM,EAAE,EAAE,QAAQ,EAAE,IAAI,EAAE,EAAE,EAAE;qBACjE;oBACD,SAAS,EAAE;wBACT,MAAM,EAAE,EAAE,QAAQ,EAAE,IAAI,EAAE,YAAY,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE;qBAC3D;oBACD,IAAI,EAAE,EAAE,MAAM,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE,EAAE;iBACjC;aACF,CAAC,CAAC;YAEH,OAAO,CAAC,GAAG,CAAC,EAAE,eAAe,EAAE,CAAC,CAAC;YACjC,OAAO,eAAe,CAAC;QACzB,CAAC;KACF,CAAC;AACJ,CAAC,CAAC;AAEF,MAAM,0BAA0B,GAAG,gCAAgC,CAAC,gBAAM,CAAC,CAAC;AAE5E,kBAAe,0BAA0B,CAAC","debug_id":"1582964a-371e-55b6-9923-6e6fa901fa57"}
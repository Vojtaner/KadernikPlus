{"version":3,"file":"stock-item-controller.js","sources":["infrastructure/controllers/stock-item-controller.ts"],"sourceRoot":"/","sourcesContent":["import createOrUpdateStockItemUseCase, {\n  CreateOrUpdateStockItemUseCaseType,\n} from \"../../application/use-cases/stock/create-or-update-stock-item\";\nimport { StockItemBuyData, StockItemCreateData } from \"@/entities/stock-item\";\nimport { ControllerFunction } from \"@/adapters/express/make-express-callback\";\nimport getStockItemByIdUseCase, {\n  GetStockItemByIdUseCaseType,\n} from \"../../application/use-cases/stock/get-stock-item-by-id\";\nimport findStockItemByNameUseCase, {\n  FindStockItemByNameUseCaseType,\n} from \"../../application/use-cases/stock/find-stock-item-by-name\";\nimport getStockItemsByStockIdUseCase, {\n  GetStockItemsByStockIdUseCaseType,\n} from \"../../application/use-cases/stock/get-stock-items-by-stock-id\";\nimport getStocksByUserIdUseCase, {\n  GetStocksByUserIdUseCaseType,\n} from \"../../application/use-cases/stock/get-stocks-by-user-id\";\nimport deleteStockItemByIdUseCase, {\n  DeleteStockItemByIdUseCaseType,\n} from \"../../application/use-cases/stock/delete-stock-item-by-id\";\n\ntype CreateOrUpdateStockItemControllerType = {\n  body: StockItemCreateData | StockItemBuyData;\n};\ntype GetStockItemByIdControllerType = {};\ntype DeleteStockItemByIdControllerType = { params: { stockItemId: string } };\ntype FindStockItemByNameControllerType = {};\ntype GetStockItemsByStockIdControllerType = {};\ntype GetStocksByUserIdControllerType = {};\n\nexport const isPurchaseStockItem = (\n  data: StockItemCreateData | StockItemBuyData\n): data is StockItemBuyData => {\n  return (\n    Object.keys(data).length === 5 &&\n    \"id\" in data &&\n    \"quantity\" in data &&\n    \"totalPrice\" in data &&\n    \"packageCount\" in data &&\n    \"stockId\" in data\n  );\n};\n\nexport const isNewStockItem = (\n  data: StockItemCreateData | StockItemBuyData\n): data is StockItemCreateData => {\n  return !(\"stockItemId\" in data) && \"threshold\" in data;\n};\n\nconst createStockItemController = (dependencies: {\n  createOrUpdateStockItemUseCase: CreateOrUpdateStockItemUseCaseType;\n  getStockItemByIdUseCase: GetStockItemByIdUseCaseType;\n  findStockItemByNameUseCase: FindStockItemByNameUseCaseType;\n  getStockItemsByStockIdUseCase: GetStockItemsByStockIdUseCaseType;\n  getStocksByUserIdUseCase: GetStocksByUserIdUseCaseType;\n  deleteStockItemByIdUseCase: DeleteStockItemByIdUseCaseType;\n}) => {\n  const createOrUpdateStockItemController: ControllerFunction<\n    CreateOrUpdateStockItemControllerType\n  > = async (httpRequest) => {\n    const data = httpRequest.body;\n\n    const newOrUpdatedStockItem =\n      await dependencies.createOrUpdateStockItemUseCase.execute(data);\n\n    return {\n      statusCode: 201,\n      body: newOrUpdatedStockItem,\n    };\n  };\n\n  const getStocksByUserIdController: ControllerFunction<\n    GetStocksByUserIdControllerType\n  > = async (httpRequest) => {\n    const userId = httpRequest.userId;\n    const stocks = await dependencies.getStocksByUserIdUseCase.execute(userId);\n\n    return {\n      statusCode: 200,\n      body: stocks,\n    };\n  };\n\n  const findStockItemByNameController: ControllerFunction<\n    FindStockItemByNameControllerType\n  > = async (httpRequest) => {\n    const { name } = httpRequest.query;\n\n    if (typeof name !== \"string\" || !name.trim()) {\n      throw new Error(\n        \"Name query parameter is required and must be a non-empty string.\"\n      );\n    }\n\n    const stockItem = await dependencies.findStockItemByNameUseCase.execute(\n      name\n    );\n\n    if (!stockItem) {\n      throw new Error(`Stock item with name \"${name}\" not found.`);\n    }\n\n    return {\n      statusCode: 200, // OK\n      body: stockItem,\n    };\n  };\n\n  const getStockItemByIdController: ControllerFunction<\n    GetStockItemByIdControllerType\n  > = async (httpRequest) => {\n    const { stockItemId } = httpRequest.params;\n    const userId = httpRequest.userId;\n\n    const stockItem = await dependencies.getStockItemByIdUseCase.execute(\n      stockItemId,\n      userId\n    );\n\n    if (!stockItem) {\n      throw new Error(`Stock item with ID \"${stockItemId}\" not found.`);\n    }\n\n    return {\n      statusCode: 200,\n      body: stockItem,\n    };\n  };\n  const deleteStockItemByIdController: ControllerFunction<\n    DeleteStockItemByIdControllerType\n  > = async (httpRequest) => {\n    const { stockItemId } = httpRequest.params;\n    const userId = httpRequest.userId;\n\n    await dependencies.deleteStockItemByIdUseCase.execute(stockItemId, userId);\n\n    return {\n      statusCode: 204,\n    };\n  };\n  const getStockItemsByStockIdController: ControllerFunction<\n    GetStockItemsByStockIdControllerType\n  > = async (httpRequest) => {\n    const { stockId } = httpRequest.params;\n    const userId = httpRequest.userId;\n\n    const stockItems = await dependencies.getStockItemsByStockIdUseCase.execute(\n      stockId,\n      userId\n    );\n\n    if (!stockItems) {\n      throw new Error(`Stock item with ID \"${stockId}\" not found.`);\n    }\n\n    return {\n      statusCode: 200,\n      body: stockItems,\n    };\n  };\n\n  return {\n    createOrUpdateStockItemController,\n    findStockItemByNameController,\n    getStockItemByIdController,\n    getStockItemsByStockIdController,\n    getStocksByUserIdController,\n    deleteStockItemByIdController,\n  };\n};\n\nconst stockItemController = createStockItemController({\n  createOrUpdateStockItemUseCase,\n  getStockItemByIdUseCase,\n  findStockItemByNameUseCase,\n  getStockItemsByStockIdUseCase,\n  getStocksByUserIdUseCase,\n  deleteStockItemByIdUseCase,\n});\nexport default stockItemController;\n"],"names":[],"mappings":"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","debug_id":"9bcb1ec2-8b5a-5080-b754-f7c64c2b4593"}
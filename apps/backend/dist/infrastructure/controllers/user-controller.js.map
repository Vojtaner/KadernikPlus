{"version":3,"file":"user-controller.js","sources":["infrastructure/controllers/user-controller.ts"],"sourceRoot":"/","sourcesContent":["import addUserUseCase, {\n  AddUserUseCaseType,\n} from \"../../application/use-cases/user/add-user\";\nimport getUserByIdUseCase, {\n  GetUserByIdUseCaseType,\n} from \"../../application/use-cases/user/get-user-by-id\";\nimport { UserCreateData } from \"@/entities/user\";\nimport { HasId } from \"@/domain/entity\";\nimport { ControllerFunction } from \"@/adapters/express/make-express-callback\";\n\ntype CreateUserControllerType = {\n  addUserController: ControllerFunction<AddUserControllerType>;\n  getUserByIdController: ControllerFunction<GetUserByIdControllerType>;\n};\n\ntype AddUserControllerType = {\n  body: UserCreateData;\n};\n\ntype GetUserByIdControllerType = { params: HasId };\n\nconst createUserController = (dependencies: {\n  getUserByIdUseCase: GetUserByIdUseCaseType;\n  addUserUseCase: AddUserUseCaseType;\n}): CreateUserControllerType => {\n  const addUserController: ControllerFunction<AddUserControllerType> = async (\n    httpRequest\n  ) => {\n    try {\n      const userData = httpRequest.body;\n\n      // Input validation (basic example - use a validation library in real app)\n      if (!userData.name || !userData.email) {\n        return {\n          statusCode: 400,\n          body: {\n            error: \"Missing required user fields: name, email.\",\n          },\n        };\n      }\n\n      // Call the AddUser use case (application layer)\n      const newUser = await dependencies.addUserUseCase.execute(userData);\n\n      return {\n        statusCode: 201, // 201 Created\n        body: newUser,\n      };\n    } catch (error: any) {\n      // Handle specific application-level errors\n      if (error.name === \"UserAlreadyExistsError\") {\n        return {\n          statusCode: 409, // Conflict\n          body: { error: error.message },\n        };\n      }\n      // Re-throw or handle other unexpected errors\n      console.error(\"Error in addUserController:\", error);\n      throw error; // Let makeExpressCallback handle the generic 500 error\n    }\n  };\n  const getUserByIdController: ControllerFunction<\n    GetUserByIdControllerType\n  > = async (httpRequest) => {\n    try {\n      const { id } = httpRequest.params;\n\n      if (!id) {\n        return {\n          statusCode: 400,\n          body: { error: \"Missing user ID in parameters.\" },\n        };\n      }\n\n      const user = await dependencies.getUserByIdUseCase.execute(id);\n\n      return {\n        statusCode: 200,\n        body: user,\n      };\n    } catch (error: any) {\n      if (error.name === \"UserNotFoundError\") {\n        return {\n          statusCode: 404,\n          body: { error: error.message },\n        };\n      }\n      console.error(\"Error in getUserByIdController:\", error);\n      throw error;\n    }\n  };\n\n  return { addUserController, getUserByIdController };\n};\n\nconst userController = createUserController({\n  getUserByIdUseCase,\n  addUserUseCase,\n});\n\nexport default userController;\n"],"names":[],"mappings":";;;;;;;AAAA,yFAEmD;AACnD,qGAEyD;AAgBzD,MAAM,oBAAoB,GAAG,CAAC,YAG7B,EAA4B,EAAE;IAC7B,MAAM,iBAAiB,GAA8C,KAAK,EACxE,WAAW,EACX,EAAE;QACF,IAAI,CAAC;YACH,MAAM,QAAQ,GAAG,WAAW,CAAC,IAAI,CAAC;YAElC,0EAA0E;YAC1E,IAAI,CAAC,QAAQ,CAAC,IAAI,IAAI,CAAC,QAAQ,CAAC,KAAK,EAAE,CAAC;gBACtC,OAAO;oBACL,UAAU,EAAE,GAAG;oBACf,IAAI,EAAE;wBACJ,KAAK,EAAE,4CAA4C;qBACpD;iBACF,CAAC;YACJ,CAAC;YAED,gDAAgD;YAChD,MAAM,OAAO,GAAG,MAAM,YAAY,CAAC,cAAc,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;YAEpE,OAAO;gBACL,UAAU,EAAE,GAAG,EAAE,cAAc;gBAC/B,IAAI,EAAE,OAAO;aACd,CAAC;QACJ,CAAC;QAAC,OAAO,KAAU,EAAE,CAAC;YACpB,2CAA2C;YAC3C,IAAI,KAAK,CAAC,IAAI,KAAK,wBAAwB,EAAE,CAAC;gBAC5C,OAAO;oBACL,UAAU,EAAE,GAAG,EAAE,WAAW;oBAC5B,IAAI,EAAE,EAAE,KAAK,EAAE,KAAK,CAAC,OAAO,EAAE;iBAC/B,CAAC;YACJ,CAAC;YACD,6CAA6C;YAC7C,OAAO,CAAC,KAAK,CAAC,6BAA6B,EAAE,KAAK,CAAC,CAAC;YACpD,MAAM,KAAK,CAAC,CAAC,uDAAuD;QACtE,CAAC;IACH,CAAC,CAAC;IACF,MAAM,qBAAqB,GAEvB,KAAK,EAAE,WAAW,EAAE,EAAE;QACxB,IAAI,CAAC;YACH,MAAM,EAAE,EAAE,EAAE,GAAG,WAAW,CAAC,MAAM,CAAC;YAElC,IAAI,CAAC,EAAE,EAAE,CAAC;gBACR,OAAO;oBACL,UAAU,EAAE,GAAG;oBACf,IAAI,EAAE,EAAE,KAAK,EAAE,gCAAgC,EAAE;iBAClD,CAAC;YACJ,CAAC;YAED,MAAM,IAAI,GAAG,MAAM,YAAY,CAAC,kBAAkB,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;YAE/D,OAAO;gBACL,UAAU,EAAE,GAAG;gBACf,IAAI,EAAE,IAAI;aACX,CAAC;QACJ,CAAC;QAAC,OAAO,KAAU,EAAE,CAAC;YACpB,IAAI,KAAK,CAAC,IAAI,KAAK,mBAAmB,EAAE,CAAC;gBACvC,OAAO;oBACL,UAAU,EAAE,GAAG;oBACf,IAAI,EAAE,EAAE,KAAK,EAAE,KAAK,CAAC,OAAO,EAAE;iBAC/B,CAAC;YACJ,CAAC;YACD,OAAO,CAAC,KAAK,CAAC,iCAAiC,EAAE,KAAK,CAAC,CAAC;YACxD,MAAM,KAAK,CAAC;QACd,CAAC;IACH,CAAC,CAAC;IAEF,OAAO,EAAE,iBAAiB,EAAE,qBAAqB,EAAE,CAAC;AACtD,CAAC,CAAC;AAEF,MAAM,cAAc,GAAG,oBAAoB,CAAC;IAC1C,kBAAkB,EAAlB,wBAAkB;IAClB,cAAc,EAAd,kBAAc;CACf,CAAC,CAAC;AAEH,kBAAe,cAAc,CAAC","debug_id":"56a8c589-4ac2-5c94-99ed-5860647ec7e2"}
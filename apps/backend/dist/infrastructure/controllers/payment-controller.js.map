{"version":3,"file":"payment-controller.js","sources":["infrastructure/controllers/payment-controller.ts"],"sourceRoot":"/","sourcesContent":["import { ControllerFunction } from \"@/adapters/express/make-express-callback\";\nimport createPaymentUseCase, {\n  CreatePaymentUseCaseType,\n} from \"../../application/use-cases/payment/create-payment\";\nimport { ComgateUpdatePaymentRequired } from \"../../application/services/comgate/comgatePaymentApi\";\nimport { Payment } from \"@prisma/client\";\nimport updatePushNotificationPaymentUseCase, {\n  UpdatePushNotificationPaymentUseCaseType,\n} from \"../../application/use-cases/payment/push-notification-payment\";\n\ntype PaymentControllerType = {\n  createPaymentController: ControllerFunction<{\n    body: {\n      subscriptionId: string;\n      amount: number;\n      provider: string;\n      currency?: string;\n    };\n  }>;\n  updatePaymentStatusController: ControllerFunction<{\n    body: ComgateUpdatePaymentRequired;\n  }>;\n};\n\nexport const createPaymentController = (dependencies: {\n  createPaymentUseCase: CreatePaymentUseCaseType;\n  updatePushNotificationPaymentUseCase: UpdatePushNotificationPaymentUseCaseType;\n}) => {\n  const updatePushNotificationPaymentController: ControllerFunction<{\n    body: ComgateUpdatePaymentRequired;\n  }> = async (httpRequest) => {\n    const data = httpRequest.body;\n\n    const paymentData: Partial<Payment> = {\n      refId: Number(data.refId),\n      transactionId: data.transId,\n      status: data.status,\n    };\n\n    try {\n      const payment =\n        await dependencies.updatePushNotificationPaymentUseCase.execute(\n          paymentData\n        );\n      return { statusCode: 200, message: \"OK\" };\n    } catch (error) {\n      throw new Error(\"Platbu se nepovedlo aktualizovat.\");\n    }\n  };\n  return {\n    createPaymentController,\n    updatePushNotificationPaymentController,\n  };\n};\n\nconst paymentController = createPaymentController({\n  createPaymentUseCase,\n  updatePushNotificationPaymentUseCase,\n});\n\nexport default paymentController;\n"],"names":[],"mappings":";;;;;;;;AACA,wGAE4D;AAG5D,8HAEuE;AAgBhE,MAAM,uBAAuB,GAAG,CAAC,YAGvC,EAAE,EAAE;IACH,MAAM,uCAAuC,GAExC,KAAK,EAAE,WAAW,EAAE,EAAE;QACzB,MAAM,IAAI,GAAG,WAAW,CAAC,IAAI,CAAC;QAE9B,MAAM,WAAW,GAAqB;YACpC,KAAK,EAAE,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC;YACzB,aAAa,EAAE,IAAI,CAAC,OAAO;YAC3B,MAAM,EAAE,IAAI,CAAC,MAAM;SACpB,CAAC;QAEF,IAAI,CAAC;YACH,MAAM,OAAO,GACX,MAAM,YAAY,CAAC,oCAAoC,CAAC,OAAO,CAC7D,WAAW,CACZ,CAAC;YACJ,OAAO,EAAE,UAAU,EAAE,GAAG,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC;QAC5C,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,MAAM,IAAI,KAAK,CAAC,mCAAmC,CAAC,CAAC;QACvD,CAAC;IACH,CAAC,CAAC;IACF,OAAO;QACL,uBAAuB,EAAvB,+BAAuB;QACvB,uCAAuC;KACxC,CAAC;AACJ,CAAC,CAAC;AA7BW,QAAA,uBAAuB,2BA6BlC;AAEF,MAAM,iBAAiB,GAAG,IAAA,+BAAuB,EAAC;IAChD,oBAAoB,EAApB,wBAAoB;IACpB,oCAAoC,EAApC,mCAAoC;CACrC,CAAC,CAAC;AAEH,kBAAe,iBAAiB,CAAC","debug_id":"d03142f9-9780-570f-978c-64034fce9dfc"}
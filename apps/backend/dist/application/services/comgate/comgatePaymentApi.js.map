{"version":3,"file":"comgatePaymentApi.js","sources":["application/services/comgate/comgatePaymentApi.ts"],"sourceRoot":"/","sourcesContent":["import { getEnvVar } from \"../../../utils/getEnvVar\";\nimport axios from \"axios\";\n\nexport type ComgatePaymentApiType = {\n  createPayment: (\n    data: ComgatePaymentData\n  ) => Promise<ComgateCreatePaymentReturnType>;\n};\n\nexport type ComgatePaymentData = {\n  price: string | number;\n  currency: string;\n  email: string;\n  label: string;\n  phone: string;\n  refId: string;\n  fullName: string;\n};\n\nexport type ComgateUpdatePaymentRequired = {\n  transId: string;\n  status: string;\n  fullName: string;\n  test: boolean;\n} & ComgatePaymentRequired;\n\ntype ComgatePaymentRequired = {\n  price: string;\n  curr: string;\n  label: string;\n  refId: string;\n  merchant: string;\n  secret: string;\n  email: string;\n};\n\nexport type ComgateCreatePaymentRequired = {\n  method: string;\n  phone: string;\n  fullName: string;\n  test: \"0\" | \"1\";\n} & ComgatePaymentRequired;\n\nexport type ComgateCreatePaymentReturnType = {\n  code: number;\n  message: string;\n  transId: string;\n  redirect: string;\n};\n\nexport function generate8DigitNumber() {\n  return Math.floor(10000000 + Math.random() * 90000000);\n}\n\nconst createComgatePaymentApi = (): ComgatePaymentApiType => {\n  const createPayment = async (data: ComgatePaymentData) => {\n    const body: ComgateCreatePaymentRequired = {\n      merchant: getEnvVar(\"MERCHANT\"),\n      test: getEnvVar(\"IS_DEVELOPMENT\") === \"true\" ? \"1\" : \"0\",\n      price: data.price.toString(),\n      curr: data.currency,\n      label: `Subscription ${data.label}`,\n      refId: data.refId,\n      method: \"ALL\",\n      email: data.email,\n      fullName: data.fullName,\n      phone: data.phone,\n      secret: getEnvVar(\"COMGATE_SECRET\"),\n    };\n\n    const base64_encode = (text: string) => {\n      return Buffer.from(text, \"utf8\").toString(\"base64\");\n    };\n\n    const autorizace = `${\n      \"Basic \" +\n      base64_encode(`${getEnvVar(\"MERCHANT\")}:${getEnvVar(\"COMGATE_SECRET\")}`)\n    }`;\n\n    console.log({ autorizace });\n\n    try {\n      const response = await axios.post<ComgateCreatePaymentReturnType>(\n        \"https://payments.comgate.cz/v2.0/payment.json\",\n        body,\n        {\n          headers: {\n            Authorization: autorizace,\n            \"Content-Type\": \"application/json\",\n            Accept: \"application/json\",\n          },\n        }\n      );\n      console.log({ response });\n      return response.data;\n    } catch (error: any) {\n      console.error(\n        \"Comgate create payment error:\",\n        error.response?.data || error.message\n      );\n      throw new Error(\"Chyba při vytváření platby Comgate.\");\n    }\n  };\n\n  return { createPayment };\n};\n\nconst comgatePaymentApi = createComgatePaymentApi();\n\nexport default comgatePaymentApi;\n"],"names":[],"mappings":";;;;;;;AAkDA,oDAEC;AApDD,wDAAqD;AACrD,kDAA0B;AAiD1B,SAAgB,oBAAoB;IAClC,OAAO,IAAI,CAAC,KAAK,CAAC,QAAQ,GAAG,IAAI,CAAC,MAAM,EAAE,GAAG,QAAQ,CAAC,CAAC;AACzD,CAAC;AAED,MAAM,uBAAuB,GAAG,GAA0B,EAAE;IAC1D,MAAM,aAAa,GAAG,KAAK,EAAE,IAAwB,EAAE,EAAE;QACvD,MAAM,IAAI,GAAiC;YACzC,QAAQ,EAAE,IAAA,qBAAS,EAAC,UAAU,CAAC;YAC/B,IAAI,EAAE,IAAA,qBAAS,EAAC,gBAAgB,CAAC,KAAK,MAAM,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG;YACxD,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,QAAQ,EAAE;YAC5B,IAAI,EAAE,IAAI,CAAC,QAAQ;YACnB,KAAK,EAAE,gBAAgB,IAAI,CAAC,KAAK,EAAE;YACnC,KAAK,EAAE,IAAI,CAAC,KAAK;YACjB,MAAM,EAAE,KAAK;YACb,KAAK,EAAE,IAAI,CAAC,KAAK;YACjB,QAAQ,EAAE,IAAI,CAAC,QAAQ;YACvB,KAAK,EAAE,IAAI,CAAC,KAAK;YACjB,MAAM,EAAE,IAAA,qBAAS,EAAC,gBAAgB,CAAC;SACpC,CAAC;QAEF,MAAM,aAAa,GAAG,CAAC,IAAY,EAAE,EAAE;YACrC,OAAO,MAAM,CAAC,IAAI,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;QACtD,CAAC,CAAC;QAEF,MAAM,UAAU,GAAG,GACjB,QAAQ;YACR,aAAa,CAAC,GAAG,IAAA,qBAAS,EAAC,UAAU,CAAC,IAAI,IAAA,qBAAS,EAAC,gBAAgB,CAAC,EAAE,CACzE,EAAE,CAAC;QAEH,OAAO,CAAC,GAAG,CAAC,EAAE,UAAU,EAAE,CAAC,CAAC;QAE5B,IAAI,CAAC;YACH,MAAM,QAAQ,GAAG,MAAM,eAAK,CAAC,IAAI,CAC/B,+CAA+C,EAC/C,IAAI,EACJ;gBACE,OAAO,EAAE;oBACP,aAAa,EAAE,UAAU;oBACzB,cAAc,EAAE,kBAAkB;oBAClC,MAAM,EAAE,kBAAkB;iBAC3B;aACF,CACF,CAAC;YACF,OAAO,CAAC,GAAG,CAAC,EAAE,QAAQ,EAAE,CAAC,CAAC;YAC1B,OAAO,QAAQ,CAAC,IAAI,CAAC;QACvB,CAAC;QAAC,OAAO,KAAU,EAAE,CAAC;YACpB,OAAO,CAAC,KAAK,CACX,+BAA+B,EAC/B,KAAK,CAAC,QAAQ,EAAE,IAAI,IAAI,KAAK,CAAC,OAAO,CACtC,CAAC;YACF,MAAM,IAAI,KAAK,CAAC,qCAAqC,CAAC,CAAC;QACzD,CAAC;IACH,CAAC,CAAC;IAEF,OAAO,EAAE,aAAa,EAAE,CAAC;AAC3B,CAAC,CAAC;AAEF,MAAM,iBAAiB,GAAG,uBAAuB,EAAE,CAAC;AAEpD,kBAAe,iBAAiB,CAAC","debug_id":"36a56ca6-496e-52cc-9f20-1b692cd756b1"}
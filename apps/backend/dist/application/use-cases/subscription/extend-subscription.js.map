{"version":3,"file":"extend-subscription.js","sources":["application/use-cases/subscription/extend-subscription.ts"],"sourceRoot":"/","sourcesContent":["// application/use-cases/subscription/extend-subscription.ts\nimport { Subscription } from \"@prisma/client\";\nimport { SubscriptionRepositoryPort } from \"../../ports/subscription-repository\";\nimport subscriptionRepositoryDb from \"../../../infrastructure/data/prisma/prisma-subscription-repository\";\n\nconst createExtendSubscriptionUseCase = (dependencies: {\n  subscriptionRepositoryDb: SubscriptionRepositoryPort;\n}) => {\n  return {\n    execute: async (\n      userId: string,\n      extraDays: number\n    ): Promise<Subscription | null> => {\n      const active =\n        await dependencies.subscriptionRepositoryDb.findActiveByUserId(userId);\n\n      if (!active) {\n        return null;\n      }\n      if (!active.endDate) {\n        throw new Error(\"Předplatné nemá konec datumu platnosti.\");\n      }\n\n      const newEndDate = new Date(active.endDate);\n      newEndDate.setDate(newEndDate.getDate() + extraDays);\n\n      return dependencies.subscriptionRepositoryDb.update(active.id, {\n        endDate: newEndDate,\n      });\n    },\n  };\n};\n\nexport type ExtendSubscriptionUseCaseType = ReturnType<\n  typeof createExtendSubscriptionUseCase\n>;\n\nconst extendSubscriptionUseCase = createExtendSubscriptionUseCase({\n  subscriptionRepositoryDb,\n});\n\nexport default extendSubscriptionUseCase;\n"],"names":[],"mappings":";;;;;;;AAGA,wIAA0G;AAE1G,MAAM,+BAA+B,GAAG,CAAC,YAExC,EAAE,EAAE;IACH,OAAO;QACL,OAAO,EAAE,KAAK,EACZ,MAAc,EACd,SAAiB,EACa,EAAE;YAChC,MAAM,MAAM,GACV,MAAM,YAAY,CAAC,wBAAwB,CAAC,kBAAkB,CAAC,MAAM,CAAC,CAAC;YAEzE,IAAI,CAAC,MAAM,EAAE,CAAC;gBACZ,OAAO,IAAI,CAAC;YACd,CAAC;YACD,IAAI,CAAC,MAAM,CAAC,OAAO,EAAE,CAAC;gBACpB,MAAM,IAAI,KAAK,CAAC,yCAAyC,CAAC,CAAC;YAC7D,CAAC;YAED,MAAM,UAAU,GAAG,IAAI,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;YAC5C,UAAU,CAAC,OAAO,CAAC,UAAU,CAAC,OAAO,EAAE,GAAG,SAAS,CAAC,CAAC;YAErD,OAAO,YAAY,CAAC,wBAAwB,CAAC,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE;gBAC7D,OAAO,EAAE,UAAU;aACpB,CAAC,CAAC;QACL,CAAC;KACF,CAAC;AACJ,CAAC,CAAC;AAMF,MAAM,yBAAyB,GAAG,+BAA+B,CAAC;IAChE,wBAAwB,EAAxB,wCAAwB;CACzB,CAAC,CAAC;AAEH,kBAAe,yBAAyB,CAAC","debug_id":"71e075a0-b2af-5324-94ae-02a4a01683b4"}
{"version":3,"file":"add-or-update-client.js","sources":["application/use-cases/clients/add-or-update-client.ts"],"sourceRoot":"/","sourcesContent":["import { ClientOrUpdateCreateData } from \"@/entities/client\";\nimport { ClientRepositoryPort } from \"../../ports/client-repository\";\nimport clientRepositoryDb from \"../../../infrastructure/data/prisma/prisma-client-repository\";\nimport { WithUserId } from \"@/entities/user\";\nimport { Client } from \"@prisma/client\";\nimport logRepositoryDb from \"../../../infrastructure/data/prisma/prisma-log-repository\";\nimport { LogRepositoryPort } from \"../../../application/ports/log-repository\";\n\nconst createAddOrUpdateClientUseCase = (dependencies: {\n  clientRepositoryDb: ClientRepositoryPort;\n  logRepositoryDb: LogRepositoryPort;\n}) => {\n  return {\n    execute: async (\n      clientData: WithUserId<ClientOrUpdateCreateData>\n    ): Promise<Client> => {\n      const newOrUpdatedClient =\n        await dependencies.clientRepositoryDb.addOrUpdate(clientData);\n\n      //udělat na to usecase a přidat to jako usecase\n      let action = \"create\";\n      let clientId: string | undefined = undefined;\n      let message = \"\";\n\n      if (clientData.id) {\n        action = \"update\";\n        clientId = clientData.id;\n        message = `Upravený klient ${clientData.firstName} ${clientData.lastName}`;\n      } else {\n        clientId = newOrUpdatedClient.id;\n        message = `Vytvořen klient ${newOrUpdatedClient.firstName} ${newOrUpdatedClient.lastName}`;\n      }\n\n      await dependencies.logRepositoryDb.log({\n        userId: clientData.userId,\n        action,\n        entityType: \"client\",\n        entityId: clientId,\n        message,\n        metadata: { input: clientData },\n        teamId: newOrUpdatedClient.teamId,\n      });\n\n      return newOrUpdatedClient;\n    },\n  };\n};\n\nconst addOrUpdateClientUseCase = createAddOrUpdateClientUseCase({\n  clientRepositoryDb,\n  logRepositoryDb,\n});\n\nexport type CreateAddOrUpdateClientUseCaseType = ReturnType<\n  typeof createAddOrUpdateClientUseCase\n>;\nexport default addOrUpdateClientUseCase;\n"],"names":[],"mappings":";;;;;;;AAEA,4HAA8F;AAG9F,sHAAwF;AAGxF,MAAM,8BAA8B,GAAG,CAAC,YAGvC,EAAE,EAAE;IACH,OAAO;QACL,OAAO,EAAE,KAAK,EACZ,UAAgD,EAC/B,EAAE;YACnB,MAAM,kBAAkB,GACtB,MAAM,YAAY,CAAC,kBAAkB,CAAC,WAAW,CAAC,UAAU,CAAC,CAAC;YAEhE,+CAA+C;YAC/C,IAAI,MAAM,GAAG,QAAQ,CAAC;YACtB,IAAI,QAAQ,GAAuB,SAAS,CAAC;YAC7C,IAAI,OAAO,GAAG,EAAE,CAAC;YAEjB,IAAI,UAAU,CAAC,EAAE,EAAE,CAAC;gBAClB,MAAM,GAAG,QAAQ,CAAC;gBAClB,QAAQ,GAAG,UAAU,CAAC,EAAE,CAAC;gBACzB,OAAO,GAAG,mBAAmB,UAAU,CAAC,SAAS,IAAI,UAAU,CAAC,QAAQ,EAAE,CAAC;YAC7E,CAAC;iBAAM,CAAC;gBACN,QAAQ,GAAG,kBAAkB,CAAC,EAAE,CAAC;gBACjC,OAAO,GAAG,mBAAmB,kBAAkB,CAAC,SAAS,IAAI,kBAAkB,CAAC,QAAQ,EAAE,CAAC;YAC7F,CAAC;YAED,MAAM,YAAY,CAAC,eAAe,CAAC,GAAG,CAAC;gBACrC,MAAM,EAAE,UAAU,CAAC,MAAM;gBACzB,MAAM;gBACN,UAAU,EAAE,QAAQ;gBACpB,QAAQ,EAAE,QAAQ;gBAClB,OAAO;gBACP,QAAQ,EAAE,EAAE,KAAK,EAAE,UAAU,EAAE;gBAC/B,MAAM,EAAE,kBAAkB,CAAC,MAAM;aAClC,CAAC,CAAC;YAEH,OAAO,kBAAkB,CAAC;QAC5B,CAAC;KACF,CAAC;AACJ,CAAC,CAAC;AAEF,MAAM,wBAAwB,GAAG,8BAA8B,CAAC;IAC9D,kBAAkB,EAAlB,kCAAkB;IAClB,eAAe,EAAf,+BAAe;CAChB,CAAC,CAAC;AAKH,kBAAe,wBAAwB,CAAC","debug_id":"a1145955-b1dd-5ec5-90c3-178d717df32f"}